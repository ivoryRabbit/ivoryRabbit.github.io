---
layout: post
title:  "R 사용기(2)"
date:   2019-12-03 22:55:59
author: ivoryRabbit
categories: 연구
comments: true
tag: R
---

### R과 Python

 기억을 더듬어보면, 나는 R을 Python보다 훨씬 일찍 사용하였다. 2014년도로 거슬러 올라가면 한 수리통계학 수업에서 R을 이용하여 몬테카를로 시뮬레이션을 실습하는 장면이 떠오른다. 당시 통계학 교수님은 원을 중심으로한 넓이가 1인 정사각형 안에 내접원을 그린 후에 원주율 Pi를 근사하기 위하여 점을 막 찍어대었다. 그 기억 속의 R은 매우 촌스러웠다. 지금 흔히 사용하는 R studio가 아닌 R console 창을 띄워놓고 1000개의 점을 찍는 모습을 목격했고, 바로 R을 사용하지 않기로 마음먹었다. 지금도 될법한(?) 코드를 짜서 작동하지 않으면 alt + F4를 누르고 싶은 충동이 들곤 한다.

 Python은 알고리즘을 공부하기 위해 큰 맘먹고 공부했던 언어이다. 2016년에 대학원을 입학했는데, 어쩌다 알게된 컴퓨터 잘하는 선배에게 가르침을 내려달라고 다짜고짜 찾아갔고, jupyter notebook으로 간단한 'hang man' 게임을 만들면서 푹 빠지게 되었다. 그러다가 다시 한번 Python을 미친듯이 익히게 된 계기가 있는데, 무려 3년 후인 2019년부터이다. Python에는 pandas라는, data frame을 아주 다루기 쉽게 해주는 패키지가 있다. 특히 pandas profiling report를 이용해 데이터를 보기좋게 요약하는 기능이 쏠쏠하다. 아무튼 이때 처음으로 data science, 데이터 과학이라는 분야를 알게되었고, 취미로 익힌 프로그래밍 언어를 써먹고 싶어서 머신러닝을 공부했었다.

 보통 Python을 이용하다보면 'for' 이나 'while' 구문, 그러니까 iteration에 익숙해진다. 그런데 pandas를 이용해 데이터를 막 만지다보면 'for'을 사용하는 것이 최악이라는 것을 느끼게 된다. apply 계열 함수를 사용하거나 numpy처럼 배열(array)연산을 지원하는 함수를 사용하면 'for'을 돌리는 것보다 30배에서 1000배 가까이 빠르다. 이런 깨달음들을 몸소 느낀 후에야 R을 우연하게 접하게 되었는데 참으로 다행이라는 생각이 들었다. 왜냐하면 R의 대표적 자료구조는 data frame이며, 이를 다루는 핵심적인 패키지가 tidyverse이기 때문이었다.

 R을 다시 사용하면서 느낀 또 다른 문제는 너무나 지저분하다는 것이다. 오랫동안 많은 사람들이 서로다른 기준을 가지고 패키지를 만들어서인지 뭔가 중심이 없다. Python을 사용할 때는, 머리 속에서 '될 것같은' 코드를 짜면 내가 예상한대로 작동하였다. 그런데 이놈의 R은 쉽지 않다. 파이프연산자가 되는게 있고 안되는게 있어서 with를 사용하고, 자료구조가 잘 안들어 맞아서 작동안하는 경우도 많았다. 아직 실력이 부족한 탓이겠지만 나의 직관과는 조금 거리가 있는 언어임은 분명하다.

(계속)

***


### R을 이용한 타이타닉 생존 분석


```R
library(titanic)
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)

titanic_train %>% 
  names()
titanic_test %>% 
  names()

titanic_train %>% 
  select(-Survived) %>% 
  rbind(titanic_test) ->
  titanic_df

# Pclass
titanic_df %>% 
  select(Pclass) %>% 
  unique()

titanic_df %>%
  mutate(Pclass = as.factor(Pclass)) %>% 
  group_by(Pclass) %>% 
  summarise(
    cnt = n()
  ) %>% 
  ggplot(aes(x = Pclass, y = cnt, fill = factor(Pclass))) + 
  geom_col(width = .5, show.legend = F) + 
  ylab('Popular')

# Sex
titanic_df %>%
  group_by(Sex) %>% 
  summarise(
    cnt = n()
  ) %>% 
  ggplot(aes(x = Sex, y = cnt, fill = factor(Sex))) + 
  geom_col(width = .5, show.legend = F) + 
  ylab('Popular')

# Sex with Survival
titanic_train %>% 
  mutate(Survived = factor(Survived)) %>% 
  group_by(Survived, Sex) %>% 
  summarise(
    cnt = n()
  ) %>% 
  ggplot(aes(x = Survived, y = cnt, fill = Sex)) +
  geom_col(width = .5, position = 'dodge') + 
  ylab('Popular') +
  scale_x_discrete(
    labels = c('1' = 'Survived', '0' = 'Dead')
  )
  
```

### 데이터 분석

독립변수 | 종속변수 | 분석방법
:-- | :-- | --:
범주형 | 범주형 | 카이제곱검정
범주형 | 연속형 | t - 검정 / 분산분석(ANOVA)
연속형 | 범주형 | 로지스틱 회귀분석 / Softmax
연속형 | 연속형 | 선형 / 다중 회귀분석 / 구조방정식
범주형 + 연속형 | 범주형 | 로지스틱 회귀분석 / Decision Tree 기반 학습
범주형 + 연속형 | 연속형 | 공분산분석(ANCOVA)

